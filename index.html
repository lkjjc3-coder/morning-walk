<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ì•„ì¹¨ ì‚°ì±… ê¸°ë¡</title>
<style>
body {
  font-family: system-ui, sans-serif;
  background: #111;
  color: #fff;
  margin: 0;
  padding: 16px;
}

h1 { text-align: center; margin-bottom: 6px; }
.subtitle { text-align: center; font-size: 14px; opacity: .8; margin-bottom: 20px; }

nav {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-bottom: 24px;
}
nav button {
  background: #222; color: #fff; border: none;
  padding: 10px 18px; border-radius: 24px; cursor: pointer;
}
nav button.active { background: #4caf50; }

.section { display: none; }
.section.active { display: block; }

.editor {
  max-width: 760px; margin: 0 auto 24px;
  background: #1c1c1c; padding: 16px; border-radius: 16px;
}

.editor input[type="file"] { margin-bottom: 10px; }

.preview {
  width: 100%; max-height: 360px; object-fit: contain;
  border-radius: 12px; background: #000; margin-bottom: 12px; display:none;
}

.editor textarea {
  width: 100%; min-height: 140px;
  background: #111; color: #fff;
  border: none; border-radius: 12px;
  padding: 12px; resize: vertical; margin-bottom: 12px;
}

.editor button {
  width: 100%; background: #4caf50; border: none; color: #fff;
  padding: 12px; border-radius: 12px; font-size: 15px; cursor: pointer;
}

.viewer {
  max-width: 900px; margin: 0 auto;
  display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  gap: 16px;
}

.card {
  background: rgba(255,255,255,0.05);
  border-radius: 14px; padding: 10px;
}
.card img { width: 100%; border-radius: 10px; }
.card .text { font-size: 14px; margin: 8px 0; opacity: .9; white-space: pre-wrap; }
.actions { display: flex; justify-content: space-between; }
.actions button {
  background: #333; border: none; color: #fff;
  border-radius: 8px; padding: 4px 10px; cursor: pointer;
}
</style>
</head>
<body>

<h1>ğŸŒ… ì•„ì¹¨ ì‚°ì±… ê¸°ë¡</h1>
<div class="subtitle">ì•„ì¹¨ ì‚°ì±…ì²˜ëŸ¼ ê°€ë³ê²Œ ë‚¨ê¸°ëŠ” ë‚˜ì˜ ê¸°ë¡</div>

<nav>
  <button class="active" data-tab="walk">ì‚°ì±…í•˜ê¸°</button>
  <button data-tab="meditation">ë¬µìƒí•˜ê¸°</button>
  <button data-tab="record">ê¸°ë¡í•˜ê¸°</button>
</nav>

<div id="walk" class="section active"></div>
<div id="meditation" class="section"></div>
<div id="record" class="section"></div>

<script>
// DOM ë¡œë”© ì™„ë£Œ í›„ ì´ˆê¸°í™” (ì €ì¥ ì•ˆ ë˜ë˜ í•µì‹¬ ì›ì¸ ìˆ˜ì •)
document.addEventListener('DOMContentLoaded', () => {
const tabs = document.querySelectorAll('nav button');
const sections = document.querySelectorAll('.section');

tabs.forEach(btn => {
  btn.addEventListener('click', () => {
    tabs.forEach(b => b.classList.remove('active'));
    sections.forEach(s => s.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById(btn.dataset.tab).classList.add('active');
  });
});

function initSection(key, title) {
  const container = document.getElementById(key);

  container.innerHTML = `
    <div class="editor">
      <h2>${title}</h2>
      <input type="file" accept="image/*" />
      <img class="preview" />
      <textarea placeholder="ê¸€ì„ ì²œì²œíˆ ë‚¨ê²¨ë³´ì„¸ìš”"></textarea>
      <button type="button">ì €ì¥í•˜ê¸°</button>
    </div>
    <div class="viewer"></div>
  `;

  const input = container.querySelector('input');
  const preview = container.querySelector('.preview');
  const textarea = container.querySelector('textarea');
  const saveBtn = container.querySelector('button');
  const viewer = container.querySelector('.viewer');

  let data = JSON.parse(localStorage.getItem(key) || '[]');
  let tempImage = null;

  input.addEventListener('change', () => {
    const file = input.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
      tempImage = e.target.result;
      preview.src = tempImage;
      preview.style.display = 'block';
    };
    reader.readAsDataURL(file);
  });

  saveBtn.addEventListener('click', () => {
    console.log('ì €ì¥ í´ë¦­ë¨');

    if (!tempImage && !textarea.value.trim()) {
      alert('ì‚¬ì§„ì´ë‚˜ ê¸€ ì¤‘ í•˜ë‚˜ëŠ” ì…ë ¥í•´ì£¼ì„¸ìš”');
      return;
    }

    const newItem = {
      img: tempImage,
      text: textarea.value.trim(),
      likes: 0,
      date: new Date().toISOString()
    };

    data.unshift(newItem);

    try {
      localStorage.setItem(key, JSON.stringify(data));
    } catch (e) {
      console.error('ì €ì¥ ì‹¤íŒ¨:', e);
      alert('ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•˜ê±°ë‚˜ ë¸Œë¼ìš°ì €ê°€ ì €ì¥ì„ ì°¨ë‹¨í–ˆìŠµë‹ˆë‹¤.
ì‚¬ì§„ ìš©ëŸ‰ì„ ì¤„ì´ê±°ë‚˜ ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ ì£¼ì„¸ìš”.');
      return;
    }

    console.log('ì €ì¥ ì™„ë£Œ, í˜„ì¬ ê°œìˆ˜:', data.length);

    tempImage = null;
    preview.src = '';
    preview.style.display = 'none';
    textarea.value = '';
    input.value = '';

    render();

    viewer.scrollIntoView({ behavior: 'smooth', block: 'start' });
  });
  });

  function render() {
    if (data.length === 0) {
      viewer.innerHTML = '<div style="grid-column:1/-1;opacity:.6;text-align:center;">ì•„ì§ ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
      return;
    }
    viewer.innerHTML = '';

    const sorted = [...data].sort((a,b)=> new Date(b.date) - new Date(a.date));

    let currentDate = '';
    sorted.forEach(item => {
      const dateStr = new Date(item.date).toLocaleDateString('ko-KR');
      if (dateStr !== currentDate) {
        currentDate = dateStr;
        const h = document.createElement('h3');
        h.style.gridColumn = '1 / -1';
        h.style.opacity = '.7';
        h.textContent = dateStr;
        viewer.appendChild(h);
      }

      const card = document.createElement('div');
      card.className = 'card';

      if (item.img) {
        const img = document.createElement('img');
        img.src = item.img;
        card.appendChild(img);
      }

      if (item.text) {
        const t = document.createElement('div');
        t.className = 'text';
        t.textContent = item.text;
        card.appendChild(t);
      }

      const actions = document.createElement('div');
      actions.className = 'actions';

      const like = document.createElement('button');
      like.textContent = `ğŸ‘ ${item.likes}`;
      like.onclick = () => { item.likes++; save(); };

      const del = document.createElement('button');
      del.textContent = 'ğŸ—‘';
      del.onclick = () => {
        if (confirm('ì‚­ì œí• ê¹Œìš”?')) {
          data = data.filter(d => d !== item);
          save();
        }
      };

      actions.append(like, del);
      card.appendChild(actions);
      viewer.appendChild(card);
    });
  }

  function save() {
    localStorage.setItem(key, JSON.stringify(data));
    render();
  }

  render();
}

initSection('walk','ì‚°ì±…í•˜ê¸°');
initSection('meditation','ë¬µìƒí•˜ê¸°');
initSection('record','ê¸°ë¡í•˜ê¸°');
});
</script>

</body>
</html>
