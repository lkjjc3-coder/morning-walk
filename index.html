<script>
document.addEventListener('DOMContentLoaded', () => {

const tabs = document.querySelectorAll('nav button');
const sections = document.querySelectorAll('.section');

tabs.forEach(btn => {
  btn.addEventListener('click', () => {
    tabs.forEach(b => b.classList.remove('active'));
    sections.forEach(s => s.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById(btn.dataset.tab).classList.add('active');
  });
});

function initSection(key, title) {
  const container = document.getElementById(key);

  container.innerHTML = `
    <div class="editor">
      <h2>${title}</h2>
      <input type="file" accept="image/*" />
      <img class="preview" />
      <textarea placeholder="ê¸€ì„ ì²œì²œíˆ ë‚¨ê²¨ë³´ì„¸ìš”"></textarea>
      <button type="button">ì €ì¥í•˜ê¸°</button>
    </div>
    <div class="viewer"></div>
  `;

  const input = container.querySelector('input');
  const preview = container.querySelector('.preview');
  const textarea = container.querySelector('textarea');
  const saveBtn = container.querySelector('button');
  const viewer = container.querySelector('.viewer');

  let data = JSON.parse(localStorage.getItem(key) || '[]');
  let tempImage = null;

  input.addEventListener('change', () => {
    const file = input.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = e => {
      tempImage = e.target.result;
      preview.src = tempImage;
      preview.style.display = 'block';
    };
    reader.readAsDataURL(file);
  });

  saveBtn.addEventListener('click', () => {
    if (!tempImage && !textarea.value.trim()) {
      alert('ì‚¬ì§„ì´ë‚˜ ê¸€ ì¤‘ í•˜ë‚˜ëŠ” ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    data.unshift({
      img: tempImage,
      text: textarea.value.trim(),
      likes: 0,
      date: new Date().toISOString()
    });

    try {
      localStorage.setItem(key, JSON.stringify(data));
    } catch (e) {
      alert(
        'ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•˜ê±°ë‚˜ ë¸Œë¼ìš°ì €ê°€ ì €ì¥ì„ ì°¨ë‹¨í–ˆìŠµë‹ˆë‹¤.\n' +
        'ì‚¬ì§„ ìš©ëŸ‰ì„ ì¤„ì´ê±°ë‚˜ ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ ì£¼ì„¸ìš”.'
      );
      return;
    }

    tempImage = null;
    preview.src = '';
    preview.style.display = 'none';
    textarea.value = '';
    input.value = '';

    render();
  });

  function render() {
    viewer.innerHTML = '';

    if (data.length === 0) {
      viewer.innerHTML =
        '<div style="grid-column:1/-1;opacity:.6;text-align:center;">ì•„ì§ ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
      return;
    }

    const sorted = [...data].sort((a, b) => new Date(b.date) - new Date(a.date));

    sorted.forEach(item => {
      const card = document.createElement('div');
      card.className = 'card';

      if (item.img) {
        const img = document.createElement('img');
        img.src = item.img;
        card.appendChild(img);
      }

      if (item.text) {
        const t = document.createElement('div');
        t.className = 'text';
        t.textContent = item.text;
        card.appendChild(t);
      }

      const actions = document.createElement('div');
      actions.className = 'actions';

      const like = document.createElement('button');
      like.textContent = `ğŸ‘ ${item.likes}`;
      like.onclick = () => {
        item.likes++;
        localStorage.setItem(key, JSON.stringify(data));
        render();
      };

      const del = document.createElement('button');
      del.textContent = 'ğŸ—‘';
      del.onclick = () => {
        if (confirm('ì‚­ì œí• ê¹Œìš”?')) {
          data = data.filter(d => d !== item);
          localStorage.setItem(key, JSON.stringify(data));
          render();
        }
      };

      actions.append(like, del);
      card.appendChild(actions);
      viewer.appendChild(card);
    });
  }

  render();
}

initSection('walk','ì‚°ì±…í•˜ê¸°');
initSection('meditation','ë¬µìƒí•˜ê¸°');
initSection('record','ê¸°ë¡í•˜ê¸°');

});
</script>
